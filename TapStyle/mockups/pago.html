<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TapStyle - Pago</title>
    <link rel="stylesheet" href="pago.css">

    <!-- Estilos globales de la fuente (puedes mover esto a pago.css) -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f9fa;
      }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container-header site-header__inner">
            <a href="index.html" class="site-header__logo">
                TapStyle
            </a>
            <nav class="site-header__nav">
                <a href="carrito.html">
                    ‚Üê Volver al carrito
                </a>
            </nav>
            <div class="site-header__actions">
                <a href="login.html" class="button-primary site-header__login-button">
                    Acceder
                </a>
            </div>
        </div>
    </header>

    <main class="checkout-container">
        <div class="checkout-card">
            <!-- Encabezado -->
            <div class="checkout-header">
                <h1 class="checkout-title">Finalizar compra</h1>
                <p class="checkout-subtitle">
                    Revisa tu pedido y completa el pago de forma segura.
                </p>
            </div>

            <!-- Resumen del pedido -->
            <div class="checkout-section">
                <h3 class="checkout-section__title">Resumen del pedido</h3>
                <div id="summary" class="summary-items-container">
                    <!-- Los productos se insertan aqu√≠ -->
                </div>

                <div class="summary-totals">
                    <div class="summary-totals__row">
                        <span>Subtotal</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-totals__row">
                        <span>IGV (18%)</span>
                        <span id="tax">$0.00</span>
                    </div>
                    <div class="summary-totals__row">
                        <span>Env√≠o</span>
                        <span>Gratis</span>
                    </div>
                    <div class="summary-totals__row summary-totals__row--total">
                        <span>Total a pagar</span>
                        <span id="total">$0.00</span>
                    </div>
                </div>
            </div>

            <!-- Formulario de pago -->
            <form id="payment-form" class="payment-form">
                <!-- Informaci√≥n de contacto -->
                <div class="checkout-section">
                    <h3 class="checkout-section__title">Informaci√≥n de contacto</h3>
                    <div class="form-grid form-grid--2-col">
                        <div>
                            <label class="form-label">Nombre</label>
                            <input type="text" required class="form-input" />
                        </div>
                        <div>
                            <label class="form-label">Correo electr√≥nico</label>
                            <input type="email" required class="form-input" />
                        </div>
                    </div>
                </div>

                <!-- Direcci√≥n de env√≠o -->
                <div class="checkout-section">
                    <h3 class="checkout-section__title">Direcci√≥n de env√≠o</h3>
                    <div class="form-section">
                        <div>
                            <label class="form-label">Direcci√≥n</label>
                            <input type="text" required class="form-input" />
                        </div>
                        <div class="form-grid form-grid--3-col">
                            <div>
                                <label class="form-label">Ciudad</label>
                                <input type="text" required class="form-input" />
                            </div>
                            <div>
                                <label class="form-label">Regi√≥n</label>
                                <input type="text" required class="form-input" />
                            </div>
                            <div>
                                <label class="form-label">C√≥digo postal</label>
                                <input type="text" required class="form-input" />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- M√©todo de pago -->
                <div class="checkout-section">
                    <h3 class="checkout-section__title">M√©todo de pago</h3>
                    <div class="form-section">
                        <div>
                            <label class="form-label">Selecciona un m√©todo</label>
                            <select id="method" class="form-select">
                                <option value="card">Tarjeta de Cr√©dito/D√©bito</option>
                                <option value="cash">Pago en Efectivo</option>
                                <option value="transfer">Transferencia Bancaria</option>
                            </select>
                        </div>

                        <!-- Datos de tarjeta -->
                        <div id="card-details" class="form-section">
                            <div>
                                <label class="form-label">N√∫mero de tarjeta</label>
                                <input
                                    type="text"
                                    placeholder="1234 5678 9012 3456"
                                    class="form-input"
                                />
                            </div>
                            <div class="form-grid form-grid--2-col">
                                <div>
                                    <label class="form-label">Fecha de vencimiento</label>
                                    <input
                                        type="text"
                                        placeholder="MM/YY"
                                        class="form-input"
                                    />
                                </div>
                                <div>
                                    <label class="form-label">CVV</label>
                                    <input
                                        type="text"
                                        placeholder="123"
                                        class="form-input"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="payment-footer">
                    <p class="payment-footer__terms">
                        Al confirmar aceptas nuestros t√©rminos y condiciones.
                    </p>
                    <div class="payment-footer__buttons">
                        <a href="carrito.html" class="button-secondary">
                            Volver al carrito
                        </a>
                        <button type="submit" class="button-primary button-primary-submit">
                            Confirmar y pagar
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- 
      SCRIPT MODIFICADO
      Ahora usa las clases CSS sem√°nticas en lugar de Tailwind 
    -->
    <script>
      (function () {
        const CART_KEY = "tapstyle_cart";

        function getCart() {
          try {
            return JSON.parse(localStorage.getItem(CART_KEY) || "[]");
          } catch {
            return [];
          }
        }

        function formatCurrency(v) {
          return "$" + Number(v).toFixed(2);
        }

        function renderSummary() {
          const cart = getCart();
          const summary = document.getElementById("summary");
          const subtotalEl = document.getElementById("subtotal");
          const taxEl = document.getElementById("tax");
          const totalEl = document.getElementById("total");
          const paymentForm = document.getElementById("payment-form");

          summary.innerHTML = "";

          if (!cart.length) {
            // MODIFICADO: Usa clases CSS
            summary.innerHTML = `
              <div class="summary-empty-state">
                <div class="summary-empty-state__icon">üõí</div>
                <p class="summary-empty-state__text">No hay productos en el carrito.</p>
                <a href="index.html" class="summary-empty-state__link">
                  Volver a la tienda ‚Üí
                </a>
              </div>
            `;
            subtotalEl.textContent = formatCurrency(0);
            taxEl.textContent = formatCurrency(0);
            totalEl.textContent = formatCurrency(0);
            paymentForm.style.display = "none";
            return;
          }

          let subtotal = 0;
          cart.forEach((item) => {
            const itemSubtotal = (item.price || 0) * (item.qty || 1);
            subtotal += itemSubtotal;

            const div = document.createElement("div");
            // MODIFICADO: Usa clases CSS
            div.className = "summary-item";
            div.innerHTML = `
              <div class="summary-item__details">
                <img src="${item.image || "https://placehold.co/60x60"}"
                  class="summary-item__image"
                  alt="${item.name}">
                <div>
                  <h4 class="summary-item__name">${item.name}</h4>
                  <div class="summary-item__meta">Cantidad: ${item.qty}</div>
                  <div class="summary-item__meta">${formatCurrency(item.price)} c/u</div>
                </div>
              </div>
              <div class="summary-item__subtotal">
                ${formatCurrency(itemSubtotal)}
              </div>
            `;
            summary.appendChild(div);
          });

          const tax = subtotal * 0.18;
          const total = subtotal + tax;

          subtotalEl.textContent = formatCurrency(subtotal);
          taxEl.textContent = formatCurrency(tax);
          totalEl.textContent = formatCurrency(total);

          paymentForm.style.display = "block";
        }

        // Mostrar u ocultar datos de tarjeta
        document.getElementById("method").addEventListener("change", (e) => {
          const cardDetails = document.getElementById("card-details");
          cardDetails.style.display = e.target.value === "card" ? "block" : "none";
        });

        // Evento de env√≠o del formulario
        document.getElementById("payment-form").addEventListener("submit", (e) => {
          e.preventDefault();

          const submitBtn = e.target.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent; // Quitamos el innerHTML
          submitBtn.disabled = true;
          
          // MODIFICADO: Usa clases CSS para el spinner
          submitBtn.innerHTML = `
            <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Procesando pago...
          `;

          setTimeout(() => {
            localStorage.removeItem(CART_KEY);

            const modal = document.createElement("div");
            // MODIFICADO: Usa clases CSS
            modal.className = "modal-overlay";
            modal.innerHTML = `
              <div class="modal-content">
                <div class="modal-icon-wrapper">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <h3 class="modal-title">¬°Pago realizado con √©xito!</h3>
                <p class="modal-text">
                  Gracias por tu compra. Te hemos enviado un correo con los detalles de tu pedido.
                </p>
                <button onclick="window.location.href='index.html'" class="button-primary modal-button">
                  Volver a la tienda
                </button>
              </div>
            `;
            document.body.appendChild(modal);
          }, 2000);
        });

        renderSummary();
      })();
    </script>
</body>
</html>