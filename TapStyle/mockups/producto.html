<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TapStyle - Tu Centro Comercial Digital</title>
    <link rel="stylesheet" href="producto.css">

    <!-- Configuración para usar la fuente Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
    </style>
</head>
<body class="main-body">
    <!-- Header -->
    <header class="site-header">
        <div class="container-header site-header__inner">
            <a href="index.html" class="site-header__logo">
            TapStyle
            </a>
            <nav class="site-header__nav">
            <a href="index.html">Inicio</a>
            <a href="carrito.html">Carrito</a>
            </nav>
        </div>
    </header>
    <!-- Contenido principal -->
    <main class="main-content">
        <section class="product-section">
            <div class="product-container">
                <div class="product-card">
                    <div class="product-grid">
                    
                        <!-- Imagen del producto -->
                        <div class="product-image-container">
                            <img
                                id="product-image"
                                src="https://placehold.co/600x600/93C5FD/ffffff?text=Producto"
                                alt="producto"
                                class="product-image"
                            />
                        </div>

                        <!-- Información del producto -->
                        <div class="product-info-container">
                            <div class="product-info-header">
                                <h1 id="product-name" class="product-name">
                                    Producto Destacado
                                </h1>
                                <div class="product-store-price-wrapper">
                                    <div id="product-store" class="product-store">
                                        Vendido por:
                                        <span class="product-store__name">Tienda Ejemplo</span>
                                    </div>
                                    <div id="product-price" class="product-price">
                                        $120.00
                                    </div>
                                </div>
                            </div>

                            <p id="product-desc" class="product-description">
                                Descripción breve y llamativa del producto. Materiales, corte y estilo resumidos para atraer al comprador.
                                Esta ficha solo es visual (mockup).
                            </p>

                            <!-- Colores -->
                            <div class="options-section">
                                <h4 class="options-label">Colores disponibles</h4>
                                <div class="color-options">
                                    <button class="color-swatch" style="background-color: #0284c7;" title="Azul"></button>
                                    <button class="color-swatch" style="background-color: #1f2937;" title="Negro"></button>
                                    <button class="color-swatch" style="background-color: #ec4899;" title="Rosa"></button>
                                    <button class="color-swatch" style="background-color: #f59e0b;" title="Amarillo"></button>
                                </div>
                            </div>

                            <!-- Tallas -->
                            <div class="options-section">
                                <h4 class="options-label">Tallas</h4>
                                <div class="size-options">
                                    <button class="size-button">S</button>
                                    <button class="size-button">M</button>
                                    <button class="size-button">L</button>
                                    <button class="size-button">XL</button>
                                </div>
                            </div>

                            <!-- Cantidad -->
                            <div classs="quantity-section">
                                <label for="product-qty" class="quantity-label">Cantidad</label>
                                <input id="product-qty" type="number" min="1" value="1" class="quantity-input" />
                            </div>

                            <!-- Botones -->
                            <div class="button-group">
                                <button id="btn-add" class="button-add-cart">
                                    Añadir al carrito
                                </button>
                                <a href="carrito.html" class="button-view-cart">
                                    Ver carrito
                                </a>
                                <a href="pago.html" class="button-buy-now">
                                    Comprar ahora
                                </a>
                            </div>

                            <!-- Material y Envío -->
                            <div class="product-details-footer">
                                <p><strong>Material:</strong> 100% algodón premium.</p>
                                <p><strong>Envío:</strong> Entrega en 3–5 días hábiles.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 
      SCRIPT MODIFICADO
      - Arregla el problema de "null"
      - Usa la clase "toast-popup"
    -->
    <script>
      (function () {
        const CART_KEY = "tapstyle_cart";

        function qs(name) {
          const url = new URL(location.href);
          return url.searchParams.get(name);
        }
        function safeDecode(v) {
          try {
            // Si v es "null" o undefined, devuélvelo para que falle el truthy check
            if (!v || v === "null") return null; 
            return decodeURIComponent(v);
          } catch (e) {
            return v || null;
          }
        }
        
        // --- LÓGICA DE DATOS MEJORADA ---

        // 1. Obtener valores por defecto del HTML
        const defaultName = document.getElementById("product-name").textContent.trim();
        const defaultPriceRaw = document.getElementById("product-price").textContent.trim();
        const defaultImage = document.getElementById("product-image").src;
        const defaultStoreHTML = document.getElementById("product-store").innerHTML;
        const defaultStoreText = document.getElementById("product-store").textContent.trim();


        // 2. Obtener valores de la URL (si existen y no son "null")
        const nameFromURL = safeDecode(qs("name"));
        const priceFromURL = safeDecode(qs("price"));
        const imageFromURL = safeDecode(qs("image"));
        const storeFromURL = safeDecode(qs("store"));

        // 3. Decidir qué valor usar (URL o default)
        const name = nameFromURL || defaultName;
        const priceRaw = priceFromURL || defaultPriceRaw;
        const image = imageFromURL || defaultImage;
        const storeText = storeFromURL || defaultStoreText;
        
        const price =
          parseFloat(priceRaw.replace(/[^0-9.,]/g, "").replace(",", ".")) || 120.0;

        // 4. Actualizar el DOM
        document.getElementById("product-name").textContent = name;
        document.getElementById("product-price").textContent =
          "$" + Number(price).toFixed(2);
        document.getElementById("product-image").src = image;
        
        // Actualizar tienda (maneja el caso de "null" de la URL)
        if(storeFromURL) {
           document.getElementById("product-store").innerHTML =
          'Vendido por: <span class="product-store__name">' +
          storeFromURL +
          "</span>";
        } else {
           // Si no hay URL, simplemente deja el HTML por defecto
           document.getElementById("product-store").innerHTML = defaultStoreHTML;
        }

        // --- LÓGICA DEL TOAST ---
        function showToast(msg) {
          let t = document.getElementById("toast");
          if (!t) {
            t = document.createElement("div");
            t.id = "toast";
            // MODIFICADO: Usa la clase CSS
            t.className = "toast-popup";
            document.body.appendChild(t);
          }
          t.textContent = msg;
          
          // Forzar reflow para reiniciar la animación
          t.style.opacity = "0";
          t.style.transform = "translateY(1rem)";
          
          setTimeout(() => {
            t.style.opacity = "1";
            t.style.transform = "translateY(0)";
          }, 20); // Pequeño delay

          setTimeout(() => {
            t.style.opacity = "0";
            t.style.transform = "translateY(1rem)";
          }, 2000); // Duración del toast
        }

        // --- LÓGICA DEL CARRITO ---
        function getCart() {
          try {
            return JSON.parse(localStorage.getItem(CART_KEY) || "[]");
          } catch (e) {
            return [];
          }
        }
        function saveCart(cart) {
          localStorage.setItem(CART_KEY, JSON.stringify(cart));
          updateCartCount();
        }
        function updateCartCount() {
          // Esta función es para el contador en el header,
          // que no está en esta página, pero la dejamos por coherencia.
        }

        function addItem(item) {
          const cart = getCart();
          const existing = cart.find((c) => c.id === item.id);
          if (existing) {
            existing.qty = (existing.qty || 0) + (item.qty || 1);
          } else {
            item.qty = item.qty || 1;
            cart.push(item);
          }
          saveCart(cart);
          showToast("Producto añadido con éxito");
        }

        document.addEventListener("DOMContentLoaded", () => {
          const btn = document.getElementById("btn-add");
          if (btn) {
            btn.addEventListener("click", (e) => {
              e.preventDefault();
              const qtyEl = document.getElementById("product-qty");
              const qty = Math.max(1, parseInt(qtyEl && qtyEl.value) || 1);
              
              const productName = document.getElementById("product-name").textContent.trim();
              const productPriceText = document.getElementById("product-price").textContent || "0";
              const productPrice =
                parseFloat(productPriceText.replace(/[^0-9.,]/g, "").replace(",", ".")) || price;
              const productImage = document.getElementById("product-image").src || image;
              
              // ID único basado en el nombre (o de la URL si existe)
              const id = qs("id") || productName.replace(/\s+/g, "_").toLowerCase();

              addItem({ id, name: productName, price: productPrice, image: productImage, qty });

              const original = btn.textContent;
              btn.textContent = "Añadido";
              btn.disabled = true;
              setTimeout(() => {
                btn.textContent = original;
                btn.disabled = false;
              }, 1000);
            });
          }
          // updateCartCount(); // (Descomentar si añades un contador de carrito)
        });
      })();
    </script>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h4 class="footer-column__title">TapStyle</h4>
                    <ul class="footer-column__list">
                        <li><a href="#">Acerca de Nosotros</a></li>
                        <li><a href="#">Trabaja con Nosotros</a></li>
                        <li><a href="#">Términos y Condiciones</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4 class="footer-column__title">Ayuda</h4>
                    <ul class="footer-column__list">
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Política de Envíos</a></li>
                        <li><a href="#">Devoluciones</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4 class="footer-column__title">Tiendas</h4>
                    <ul class="footer-column__list">
                        <li><a href="#">Regístrate como Vendedor</a></li>
                        <li><a href="#">Panel de Administración</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4 class="footer-column__title">Síguenos</h4>
                    <div class="footer-social">
                        <a href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2v-2c0-2.04 1.25-3.16 3.06-3.16.88 0 1.76.13 2.05.2v2.33h-1.35c-1.06 0-1.28.52-1.28 1.26V15h2.5l-.4 3H14v6.8c4.56-.93 8-4.96 8-9.8V12z"/></svg>
                        </a>
                        <a href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7.8 2h8.4C17.61 2 20 4.39 20 7.8v8.4c0 3.41-2.39 5.8-5.8 5.8H7.8C4.39 22 2 19.61 2 16.2V7.8C2 4.39 4.39 2 7.8 2zm-.22 4a.8.8 0 100 1.6.8.8 0 000-1.6zm8.82 4.4a5 5 0 11-10 0 5 5 0 0110 0zm-8 0a3 3 0 106 0 3 3 0 00-6 0z"/></svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 TapStyle S.A. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>
</body>
</html>